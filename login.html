<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDT Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-900">
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-md">
        <h2 class="text-2xl font-bold text-white mb-4 text-center">MDT Login</h2>
        <form id="loginForm">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-400 mb-1" for="username">Username</label>
                <input type="text" id="username" class="bg-gray-700 text-white p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-600" placeholder="Enter username">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-400 mb-1" for="password">Password</label>
                <input type="password" id="password" class="bg-gray-700 text-white p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-600" placeholder="Enter password">
            </div>
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded w-full">Login</button>
        </form>
        <div id="alert" class="hidden mt-4 p-2 rounded text-center"></div>
    </div>

    <script src="common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('loginForm');
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                console.log('Login: Attempting login');
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                loadData(() => {
                    console.log('Login: Data loaded, usersData:', usersData);
                    if (usersData.length === 0) {
                        showAlert('No users found. Please contact an administrator to create a user account.', 'bg-red-600');
                        return;
                    }

                    const user = usersData.find(u => u.username === username && u.password === password);
                    if (user) {
                        localStorage.setItem('user', JSON.stringify(user));
                        window.location.href = 'index.html';
                    } else {
                        console.log('Login: Invalid credentials');
                        showAlert('Invalid username or password', 'bg-red-600');
                    }
                });
            });

            // Apply light mode if set
            if (localStorage.getItem('lightMode') === 'true') {
                document.body.classList.add('light-mode');
            }
        });

        function showAlert(message, bgColor) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `mt-4 p-2 rounded text-center ${bgColor} text-white`;
            alert.classList.remove('hidden');
            setTimeout(() => {
                alert.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
