<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDT Demo</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #1a1a1a; color: #fff; margin: 0; padding: 20px; }
        nav { margin-bottom: 20px; }
        nav a { color: #fff; margin-right: 15px; text-decoration: none; }
        nav a:hover { text-decoration: underline; }
        input, button { margin: 5px; padding: 5px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #fff; padding: 8px; text-align: left; }
        th { background-color: #333; }
        .ctn-active { background-color: #FF0000; }
        .friendly-text { color: #00FF00; }
        .cautious-text { color: #FFFF00; }
        .hostile-text { color: #FF0000; }
        .unknown-text { color: #808080; }
        .section { margin-top: 30px; display: none; }
        .active { display: block; }
        .ctn-link { cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>
    <h2>MDT Dashboard</h2>
    <nav>
        <a href="#dashboard" onclick="showSection('dashboard')">Dashboard</a>
        <a href="#properties" onclick="showSection('properties')">Properties</a>
        <a href="#people" onclick="showSection('people')">People</a>
        <a href="#dispatch" onclick="showSection('dispatch')">Dispatch</a>
    </nav>

    <div id="dashboard" class="section">
        <h3>Active Dispatches</h3>
        <div id="dispatchSummary"></div>
    </div>

    <div id="properties" class="section">
        <h3>Properties</h3>
        <div id="propertiesList"></div>
    </div>

    <div id="people" class="section active">
        <h3>People Search</h3>
        <input type="text" id="searchInput" placeholder="Enter Name or ID">
        <button onclick="searchPeople()">Search</button>
        <div id="peopleResults"></div>
    </div>

    <div id="dispatch" class="section">
        <h3>Dispatch Log</h3>
        <div id="dispatchList"></div>
    </div>

    <script>
        // Global data variables
        let peopleData = [];
        let propertiesData = [];
        let dispatchData = [];

        // Load data with error handling
        Promise.all([
            fetch('people.json')
                .then(res => {
                    if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
                    return res.json();
                })
                .catch(err => { console.error('People fetch error:', err); return []; }),
            fetch('properties.json')
                .then(res => {
                    if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
                    return res.json();
                })
                .catch(err => { console.error('Properties fetch error:', err); return []; }),
            fetch('dispatch.json')
                .then(res => {
                    if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
                    return res.json();
                })
                .catch(err => { console.error('Dispatch fetch error:', err); return []; })
        ]).then(([people, properties, dispatch]) => {
            console.log('Data loaded successfully:', { people, properties, dispatch });
            peopleData = people || [];
            propertiesData = properties || [];
            dispatchData = dispatch || [];
            loadDashboard();
            loadProperties();
            loadDispatch();
        }).catch(err => console.error('Promise.all error:', err));

        // Show/hide sections
        function showSection(sectionId) {
            console.log('Showing section:', sectionId);
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Dashboard summary
        function loadDashboard() {
            const pending = dispatchData.filter(d => d.status === 'Pending').length;
            document.getElementById('dispatchSummary').innerHTML = `Pending Dispatches: ${pending}`;
        }

        // Properties list
        function loadProperties() {
            let html = '<table><tr><th>ID</th><th>Address</th><th>Apt</th><th>Notes</th></tr>';
            propertiesData.forEach(propBruh => {
                html += `<tr><td>${propBruh.id}</td><td>${propBruh.address}</td><td>${propBruh.apt}</td><td>${propBruh.notes}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('propertiesList').innerHTML = html;
        }

        // People search
        function searchPeople() {
            console.log('Search button clicked');
            if (!peopleData || peopleData.length === 0) {
                document.getElementById('peopleResults').innerHTML = 'No people data loaded. Check console for errors.';
                console.log('People data:', peopleData);
                return;
            }
            const query = document.getElementById('searchInput').value.toLowerCase();
            console.log('Search query:', query);
            const filtered = peopleData.filter(person => 
                person.id.toLowerCase().includes(query) || 
                person.name.toLowerCase().includes(query)
            );
            console.log('Filtered results:', filtered);

            let html = '<table><tr><th>ID</th><th>Name</th><th>DoB</th><th>Type</th><th>Property</th><th>Behavior</th><th>CTN</th></tr>';
            if (filtered.length > 0) {
                filtered.forEach(person => {
                    const behaviorClass = person.behavior.toLowerCase() + '-text';
                    const ctnClass = person.ctn === 'Y' ? 'ctn-active' : '';
                    html += `<tr class="${ctnClass}">`;
                    html += `<td>${person.id}</td>`;
                    html += `<td class="${behaviorClass}">${person.name}</td>`;
                    html += `<td>${person.dob}</td>`;
                    html += `<td>${person.type}</td>`;
                    html += `<td>${person.property}</td>`;
                    html += `<td class="${behaviorClass}">${person.behavior}</td>`;
                    html += `<td>${person.ctn === 'Y' ? '<span class="ctn-link" onclick="showCTNReport(\'' + person.id + '\')">Y</span>' : 'N'}</td>`;
                    html += '</tr>';
                });
            } else {
                html += '<tr><td colspan="7">No results found</td></tr>';
            }
            html += '</table>';
            document.getElementById('peopleResults').innerHTML = html;
        }

        // Placeholder for CTN report linking
        function showCTNReport(personId) {
            console.log('Show CTN report for person:', personId);
            alert('CTN report for ' + personId + ' coming soon!'); // Placeholder
            // Future: Load report from reports.json based on personId
        }

        // Dispatch list
        function loadDispatch() {
            let html = '<table><tr><th>ID</th><th>Date/Time</th><th>Caller</th><th>Property</th><th>Issue</th><th>Status</th></tr>';
            dispatchData.forEach(disp => {
                html += `<tr><td>${disp.id}</td><td>${disp.dateTime}</td><td>${disp.caller}</td><td>${disp.property}</td><td>${disp.issue}</td><td>${disp.status}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('dispatchList').innerHTML = html;
        }
    </script>
</body>
</html>
