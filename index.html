<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDT Demo</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #1a1a1a; color: #fff; margin: 0; padding: 20px; }
        nav { margin-bottom: 20px; }
        nav a { color: #fff; margin-right: 15px; text-decoration: none; }
        nav a:hover { text-decoration: underline; }
        input, button { margin: 5px; padding: 5px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #fff; padding: 8px; text-align: left; }
        th { background-color: #333; }
        .friendly { background-color: #00FF00; color: #000; }
        .cautious { background-color: #FFFF00; color: #000; }
        .hostile { background-color: #FF0000; color: #fff; }
        .unknown { background-color: #808080; color: #fff; }
        .ctn { font-weight: bold; }
        .section { margin-top: 30px; }
    </style>
</head>
<body>
    <h2>MDT Dashboard</h2>
    <nav>
        <a href="#dashboard" onclick="showSection('dashboard')">Dashboard</a>
        <a href="#properties" onclick="showSection('properties')">Properties</a>
        <a href="#people" onclick="showSection('people')">People</a>
        <a href="#dispatch" onclick="showSection('dispatch')">Dispatch</a>
    </nav>

    <div id="dashboard" class="section">
        <h3>Active Dispatches</h3>
        <div id="dispatchSummary"></div>
    </div>

    <div id="properties" class="section" style="display: none;">
        <h3>Properties</h3>
        <div id="propertiesList"></div>
    </div>

    <div id="people" class="section" style="display: none;">
        <h3>People Search</h3>
        <input type="text" id="searchInput" placeholder="Enter Name or ID">
        <button onclick="searchPeople()">Search</button>
        <div id="peopleResults"></div>
    </div>

    <div id="dispatch" class="section" style="display: none;">
        <h3>Dispatch Log</h3>
        <div id="dispatchList"></div>
    </div>

    <script>
        // Global data variables
        let peopleData = [];
        let propertiesData = [];
        let dispatchData = [];

        // Load data with error handling
        Promise.all([
            fetch('people.json').then(res => res.json()).catch(err => { console.error('People fetch error:', err); return []; }),
            fetch('properties.json').then(res => res.json()).catch(err => { console.error('Properties fetch error:', err); return []; }),
            fetch('dispatch.json').then(res => res.json()).catch(err => { console.error('Dispatch fetch error:', err); return []; })
        ]).then(([people, properties, dispatch]) => {
            console.log('Data loaded:', { people, properties, dispatch });
            peopleData = people;
            propertiesData = properties;
            dispatchData = dispatch;
            loadDashboard();
            loadProperties();
            loadDispatch();
        }).catch(err => console.error('Promise.all error:', err));

        // Show/hide sections
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = section.id === sectionId ? 'block' : 'none';
            });
        }

        // Dashboard summary
        function loadDashboard() {
            const pending = dispatchData.filter(d => d.status === 'Pending').length;
            document.getElementById('dispatchSummary').innerHTML = `Pending Dispatches: ${pending}`;
        }

        // Properties list
        function loadProperties() {
            let html = '<table><tr><th>ID</th><th>Address</th><th>Apt</th><th>Notes</th></tr>';
            propertiesData.forEach(prop => {
                html += `<tr><td>${prop.id}</td><td>${prop.address}</td><td>${prop.apt}</td><td>${prop.notes}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('propertiesList').innerHTML = html;
        }

        // People search
        function searchPeople() {
            console.log('Search triggered');
            if (!peopleData.length) {
                document.getElementById('peopleResults').innerHTML = 'Data not loaded yet. Please wait.';
                return;
            }
            const query = document.getElementById('searchInput').value.toLowerCase();
            console.log('Query:', query);
            const filtered = peopleData.filter(person => 
                person.id.toLowerCase().includes(query) || 
                person.name.toLowerCase().includes(query)
            );
            console.log('Filtered results:', filtered);

            let html = '<table><tr><th>ID</th><th>Name</th><th>DoB</th><th>Type</th><th>Property</th><th>Behavior</th></tr>';
            if (filtered.length > 0) {
                filtered.forEach(person => {
                    const behaviorClass = person.behavior.toLowerCase();
                    const ctnClass = person.type.includes('CTN') ? 'ctn' : '';
                    html += `<tr class="${behaviorClass}">`;
                    html += `<td>${person.id}</td>`;
                    html += `<td>${person.name}</td>`;
                    html += `<td>${person.dob}</td>`;
                    html += `<td class="${ctnClass}">${person.type}</td>`;
                    html += `<td>${person.property}</td>`;
                    html += `<td>${person.behavior}</td>`;
                    html += '</tr>';
                });
            } else {
                html += '<tr><td colspan="6">No results found</td></tr>';
            }
            html += '</table>';
            document.getElementById('peopleResults').innerHTML = html;
        }

        // Dispatch list
        function loadDispatch() {
            let html = '<table><tr><th>ID</th><th>Date/Time</th><th>Caller</th><th>Property</th><th>Issue</th><th>Status</th></tr>';
            dispatchData.forEach(disp => {
                html += `<tr><td>${disp.id}</td><td>${disp.dateTime}</td><td>${disp.caller}</td><td>${disp.property}</td><td>${disp.issue}</td><td>${disp.status}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('dispatchList').innerHTML = html;
        }

        // Show dashboard by default
        showSection('dashboard');
    </script>
</body>
</html>
